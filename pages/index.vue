<template>
    <div>
        <!-- Hero Section with Banner Slider -->
        <PublicAppHero :banners="banners.length > 0 ? banners : [{ imageUrl: schoolConfig?.heroImage || '' }]"
            :slogan="schoolConfig?.slogan" />

        <!-- About Preview Section -->
        <section class="py-16 md:py-24">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <!-- Image -->
                    <div class="rounded-2xl overflow-hidden shadow-xl">
                        <NuxtImg :src="schoolConfig?.aboutImage || 'https://placehold.co/800x600'" alt="School"
                            class="w-full h-full object-cover" loading="lazy" />
                    </div>

                    <!-- Content -->
                    <div>
                        <h2 class="text-3xl md:text-4xl font-bold text-slate-800 dark:text-white mb-6">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                        </h2>
                        <div class="space-y-6">
                            <div>
                                <h3 class="text-xl font-bold text-primary-600 mb-2">‡∏ß‡∏¥‡∏™‡∏±‡∏¢‡∏ó‡∏±‡∏®‡∏ô‡πå (Vision)</h3>
                                <p class="text-slate-600 dark:text-slate-300 leading-relaxed">
                                    {{ schoolConfig?.vision || defaultVision }}
                                </p>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-primary-600 mb-2">‡∏û‡∏±‡∏ô‡∏ò‡∏Å‡∏¥‡∏à (Mission)</h3>
                                <p class="text-slate-600 dark:text-slate-300 leading-relaxed">
                                    {{ schoolConfig?.mission || defaultMission }}
                                </p>
                            </div>
                            <div class="pt-4">
                                <NuxtLink to="/about"
                                    class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-primary-600 hover:bg-primary-700 transition-colors shadow-md">
                                    ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
                                </NuxtLink>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Latest News Section -->
        <section class="py-16 md:py-24 bg-white dark:bg-slate-800">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <!-- Header -->
                <div class="flex justify-between items-end mb-12">
                    <div>
                        <h2 class="text-3xl md:text-4xl font-bold text-slate-800 dark:text-white mb-2">‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                        </h2>
                        <p class="text-slate-600">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                    </div>
                    <NuxtLink to="/news"
                        class="text-primary-600 hover:text-primary-700 font-bold flex items-center gap-2">
                        ‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí
                    </NuxtLink>
                </div>

                <!-- News Grid -->
                <div v-if="latestNews.length > 0" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <PublicNewsCard v-for="news in latestNews" :key="news._id" :news="news" />
                </div>
                <div v-else class="text-center py-12 text-slate-500">
                    ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£
                </div>
            </div>
        </section>

        <!-- Quick Stats Section -->
        <section class="py-16 md:py-24">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-800 dark:text-white mb-12 text-center">
                    ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                </h2>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-6">
                    <PublicStatCard icon="üë®‚Äçüéì" :value="schoolConfig?.stats?.students || 0" label="‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" />
                    <PublicStatCard icon="üë®‚Äçüè´" :value="schoolConfig?.stats?.teachers || 0" label="‡∏Ñ‡∏£‡∏π‡πÅ‡∏•‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£" />
                    <PublicStatCard icon="üìÖ" :value="schoolConfig?.stats?.foundedYear || 2508" label="‡∏õ‡∏µ‡∏Å‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á" />
                    <PublicStatCard icon="üèÜ" :value="schoolConfig?.stats?.awards || 0" label="‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•" />
                </div>
            </div>
        </section>

        <!-- Upcoming Events Section -->
        <section class="py-16 md:py-24 bg-white dark:bg-slate-800">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <!-- Header -->
                <div class="flex justify-between items-end mb-12">
                    <div>
                        <h2 class="text-3xl md:text-4xl font-bold text-slate-800 dark:text-white mb-2">
                            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏°‡∏≤‡∏ñ‡∏∂‡∏á</h2>
                        <p class="text-slate-600 dark:text-slate-400">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                    </div>
                    <NuxtLink to="/calendar"
                        class="text-primary-600 hover:text-primary-700 font-bold flex items-center gap-2">
                        ‡∏î‡∏π‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô ‚Üí
                    </NuxtLink>
                </div>

                <!-- Events List -->
                <div v-if="upcomingEvents.length > 0" class="grid md:grid-cols-2 gap-4">
                    <PublicEventCard v-for="event in upcomingEvents" :key="event._id" :event="event" />
                </div>
                <div v-else class="text-center py-12 text-slate-500">
                    ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏°‡∏≤‡∏ñ‡∏∂‡∏á
                </div>
            </div>
        </section>

        <!-- Gallery Preview Section -->
        <section class="py-16 md:py-24">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <!-- Header -->
                <div class="flex justify-between items-end mb-12">
                    <div>
                        <h2 class="text-3xl md:text-4xl font-bold text-slate-800 dark:text-white mb-2">‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà</h2>
                        <p class="text-slate-600 dark:text-slate-400">‡∏†‡∏≤‡∏û‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ</p>
                    </div>
                    <NuxtLink to="/gallery"
                        class="text-primary-600 hover:text-primary-700 font-bold flex items-center gap-2">
                        ‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí
                    </NuxtLink>
                </div>

                <!-- Gallery Grid -->
                <div v-if="galleryAlbums.length > 0" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    <NuxtLink v-for="album in galleryAlbums" :key="album._id" :to="`/gallery/${album._id}`"
                        class="aspect-square rounded-xl overflow-hidden bg-slate-200 dark:bg-slate-700 hover:scale-105 transition-transform cursor-pointer group relative">
                        <NuxtImg :src="album.coverImage || 'https://via.placeholder.com/400'" :alt="album.title"
                            class="w-full h-full object-cover" loading="lazy" />
                        <div
                            class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                            <span class="text-white font-bold text-center px-2">{{ album.title }}</span>
                        </div>
                    </NuxtLink>
                </div>
                <div v-else class="text-center py-12 text-slate-500">
                    ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
                </div>
            </div>
        </section>
    </div>
</template>

<script setup lang="ts">
definePageMeta({
    layout: 'default'
})

// Critical data - loads immediately (above-the-fold content)
const { data: criticalData } = await useAsyncData('home-critical', async () => {
    const [configRes, newsRes, bannersRes] = await Promise.all([
        $fetch('/api/config'),
        $fetch('/api/news'),
        $fetch('/api/banners')
    ])

    return {
        schoolConfig: (configRes as any).data,
        latestNews: ((newsRes as any).data || [])
            .filter((news: any) => news.isPublished)
            .sort((a: any, b: any) => new Date(b.publishedAt).getTime() - new Date(a.publishedAt).getTime())
            .slice(0, 3),
        banners: ((bannersRes as any).data || [])
            .filter((banner: any) => banner.isActive)
            .sort((a: any, b: any) => a.orderIndex - b.orderIndex)
    }
})

// Secondary data - loads lazily (below-the-fold content)
const { data: secondaryData } = useLazyAsyncData('home-secondary', async () => {
    const [eventsRes, albumsRes] = await Promise.all([
        $fetch('/api/calendar'),
        $fetch('/api/gallery')
    ])

    return {
        upcomingEvents: ((eventsRes as any).data || [])
            .filter((event: any) => new Date(event.startDate) >= new Date())
            .sort((a: any, b: any) => new Date(a.startDate).getTime() - new Date(b.startDate).getTime())
            .slice(0, 5),
        galleryAlbums: ((albumsRes as any).data || [])
            .filter((album: any) => album.isPublished)
            .sort((a: any, b: any) => new Date(b.eventDate).getTime() - new Date(a.eventDate).getTime())
            .slice(0, 8)
    }
})

const schoolConfig = computed(() => criticalData.value?.schoolConfig)
const latestNews = computed(() => criticalData.value?.latestNews || [])
const banners = computed(() => criticalData.value?.banners || [])
const upcomingEvents = computed(() => secondaryData.value?.upcomingEvents || [])
const galleryAlbums = computed(() => secondaryData.value?.galleryAlbums || [])

// Preload Hero Image
useHead({
    link: [
        {
            rel: 'preload',
            as: 'image',
            href: computed(() => banners.value[0]?.imageUrl || schoolConfig.value?.heroImage || '')
        }
    ]
})

const defaultVision = '‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏≤‡∏ä‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ô‡∏∏‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå 41 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏¢‡∏∞‡∏•‡∏≤ ‡∏Å‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏µ ‡∏û.‡∏®. 2508 ‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏£‡∏∞‡∏°‡∏´‡∏≤‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ò‡∏¥‡∏Ñ‡∏∏‡∏ì‡∏Ç‡∏≠‡∏á‡∏û‡∏£‡∏∞‡∏ö‡∏≤‡∏ó‡∏™‡∏°‡πÄ‡∏î‡πá‡∏à‡∏û‡∏£‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏±‡∏ß ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏Å‡πà‡πÄ‡∏¢‡∏≤‡∏ß‡∏ä‡∏ô‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ'
const defaultMission = '‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏°‡∏∏‡πà‡∏á‡∏°‡∏±‡πà‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ô‡∏î‡∏µ ‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏° ‡∏à‡∏£‡∏¥‡∏¢‡∏ò‡∏£‡∏£‡∏° ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏™‡∏π‡πà‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡πÇ‡∏•‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á'
</script>
